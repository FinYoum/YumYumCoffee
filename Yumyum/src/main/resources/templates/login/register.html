<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="yumyum/layout/basic">
<th:block layout:fragment="title">
	<title>Yum회원가입</title>
</th:block>

<th:block layout:fragment="content">
<div class="card-content">

<form class="form-horizontal" th:action="@{/register}" th:object="${member}" method="post">
	<h2>회원가입</h2>
	<input type="hidden" th:if="*{userNum != null and userNum > 0}" th:field="*{userNum}" />
     
	<div class="form-group">
		<label for="name" class="col-sm-2 control-label">이름</label>
		<div class="col-sm-10">
			<input type="text" id="userName" name="userName" th:field="*{name}" 
					class="form-control" placeholder="이름을 입력해 주세요."
					required oninput = "nameCheck()" />
			<span class="span_name_check" style="display:none;"></span>
		</div>
	</div>
	
	<div class="form-group">
		<label for="id" class="col-sm-2 control-label">아이디</label>
		<div class="col-sm-10">
			<input type="text" id="userId" name="userId" th:field="*{id}" 
					class="form-control" placeholder="6~10자 영문 소문자, 숫자를 사용하세요." 
					required oninput = "idCheck()" />
			<span class="span_id_check" style="display:none;"></span>
		</div>
	</div>
    
	<div class="form-group">
		<label for="pw" class="col-sm-2 control-label">비밀번호</label>
		<div class="col-sm-10">
			<input type="password" id="passcode" name="passcode" th:field="*{pw}" 
					class="form-control" placeholder="10~15자 영문 대, 소문자, 숫자를 사용하세요."
					required oninput = "pwCheck()" />
			<span class="span_password_check" style="display:none;"></span>
		</div>
	</div>
	
	<div class="form-group">
		<label class="col-sm-2 control-label">비밀번호 확인</label>
		<div class="col-sm-10">
			<input type="password" id="passcode1" name="passcode1" class="form-control" 
					placeholder="10~15자 영문 대, 소문자, 숫자를 사용하세요."
					required oninput = "pwCheck1()" />
			<span class="span_password1_check" style="display:none;"></span>
		</div>
	</div>
	
	<div class="form-group">
		<label for="tel" class="col-sm-2 control-label">전화번호</label>
		<div class="col-sm-10">
			<input type="text" id="tel" name="tel" th:field="*{tel}" class="form-control" 
					placeholder="'-'와 함께 전화번호를 입력해 주세요." 
					required oninput = "phoneCheck()" />
			<span class="span_tel_check" style="display:none;"></span>
		</div>
	</div>
	
	<div class="form-group">
		<label for="email" class="col-sm-2 control-label">이메일</label>
		<div class="col-sm-10">
			<input type="text" id="email" name="email" th:field="*{email}" 
					class="form-control" placeholder="이메일을 입력해 주세요." 
					required oninput = "emailCheck()" />
			<span class="span_email_check" style="display:none;"></span>
		</div>
	</div>
	
	<div class="form-group">
		<label for="birth" class="col-sm-2 control-label">생년월일</label>
		<div class="col-sm-10">
			<input type="text" id="birth" name="birth" th:field="*{birth}" 
					class="form-control" placeholder="생년월일(yyyy-mm-dd)을 입력해 주세요."
					required oninput = "birthCheck()" />
			<span class="span_birth_check" style="display:none;"></span>
		</div>
	</div>

	<div class="btn_wrap text-center">
		<a th:href="@{/login}" class="btn btn-default waves-effect waves-light">뒤로가기</a>
		<button type="submit" class="btn btn-primary waves-effect waves-light">가입하기</button>
	</div>
</form>
</div>
		<!-- /.card-content -->
</th:block>
<th:block layout:fragment="script">
	<script src='https://code.jquery.com/jquery-3.5.0.js'></script>
	<script th:inline="javascript">
		/*<![CDATA[ */
	
/* let flag=""; */
$(document)
.on('submit', function() {
 	if (!nameCheck($('input[name=userName]').val())) {
		alert('이름을 확인해주세요.');
		return false;
		
	}
	if (!idCheck($('#userId').val())) {
		alert('ID를 확인해주세요.');
		return false;
		
	}
	if (!pwCheck($('#passcode').val())) {
		alert('비밀번호를 확인해주세요.');
		return false;
		
	} 
	if ($('#passcode').val() != $('#passcode1').val()) {
		alert('비밀번호와 비밀번호 확인이 같지 않습니다.');
		return false;
		
	}
	if (!phoneCheck($('#tel').val())) {
		alert('전화번호를 확인해주세요.');
		return false;
		
	}
	if (!emailCheck($('#email').val())) {
		alert('이메일을 확인해주세요.');
		return false;
		
	}
	if (!birthCheck($('#birth').val())) {
		alert('생년월일을 확인해주세요.');
		return false;
		
	} else {
		return true;
	}
});

function nameCheck(){ /*이름 정규식*/
	
    var nameRegExp = /^[가-힣]{2,6}$/;
    
    var name = $('#userName').val();
    if(!nameRegExp.test(name)) {
    	$('.span_name_check').html("이름을 제대로 입력해주세요.");
        $('.span_name_check').css("display","inline-block");
        $('.span_name_check').css("color","#6A82FB");
        return false;
    	
    } else {
    	$('.span_name_check').css("display","none");
        return true;
    };
};
function idCheck() { /*아이디 정규식*/
	var idRegExp = /^[a-z0-9]{6,10}$/;
	
    var userid = $('#userId').val();
    if(!idRegExp.test(userid)) {
    	$('.span_id_check').html("아이디를 제대로 입력해주세요.");
        $('.span_id_check').css("display","inline-block");
        $('.span_id_check').css("color","#6A82FB");
    	return false;
    	
    } else {
		$('.span_id_check').html("사용 가능한 아이디입니다.");
        $('.span_id_check').css("display","inline-block");
		$('.span_id_check').css("color","black"); 
        return true;
    };
	$.ajax({
    	url:'/idOverlapCheck',
        type:'post',
        data:{id:userid},
        success:function(result){ //컨트롤러에서 넘어온 result값을 받는다 
        	if(result != 1){ //result가 1이 아니면(=0일 경우) -> 사용 가능한 아이디 
        		$('.span_id_check').html("사용 가능한 아이디입니다.");
                $('.span_id_check').css("display","inline-block");
				$('.span_id_check').css("color","black"); 
		        return true;
                
            } else { // result가 1일 경우 -> 이미 존재하는 아이디
        		$('.span_id_check').html("이미 존재하는 아이디입니다.");
                $('.span_id_check').css("display","inline-block");
                $('.span_id_check').css("color","#6A82FB");
                return false;
            }
        },
        error:function(){
            console.log("에러입니다");
            return false;
        }
	});
	return false;
}
function pwCheck(){ /*비밀번호 정규식*/
	var pwRegExp = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&^])[A-Za-z\d@$!%*#?&^]{10,20}$/;
	
	var pw = $('#passcode').val();
	if(!pwRegExp.test(pw)) {
		$('.span_password_check').html("비밀번호를 제대로 입력해주세요.");
        $('.span_password_check').css("display","inline-block");
        $('.span_password_check').css("color","#6A82FB");
		return false;
		
	} else {
    	$('.span_password_check').css("display","none");
        return true;
    };
};
function pwCheck1(){ /* 비밀번호확인 */
	
	if($('#passcode1').val() != $('#passcode').val()) {
		$('.span_password1_check').html("비밀번호와 같지 않습니다.");
        $('.span_password1_check').css("display","inline-block");
        $('.span_password1_check').css("color","#6A82FB");
		return false;
		
	} else {
    	$('.span_password1_check').css("display","none");
        return true;
    };
};
function phoneCheck(){ /*전화번호 정규식*/
	
    var telRegExp = /^\d{3}-\d{3,4}-\d{4}$/;
    
    var tel = $('#tel').val();
    if(!telRegExp.test(tel)) {
    	$('.span_tel_check').html("휴대폰번호를 제대로 입력해주세요.");
        $('.span_tel_check').css("display","inline-block");
        $('.span_tel_check').css("color","#6A82FB");
        return false;
    	
    } else {
    	$('.span_tel_check').css("display","none");
        return true;
    };
};
function emailCheck(){ /*이메일 정규식*/
    var emailRegExp = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
    
    var email = $('#email').val();
    if(!emailRegExp.test(email)) {
    	$('.span_email_check').html("이메일을 제대로 입력해주세요.");
        $('.span_email_check').css("display","inline-block");
        $('.span_email_check').css("color","#6A82FB");
		return false;
		
    } else {
    	$('.span_email_check').css("display","none");
        return true;
    };
};
function birthCheck(){ /*생년월일 정규식*/
	var birthRegExp = /^(19[0-9][0-9]|20\d{2})-(0[0-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/;
	
	var birth = $('#birth').val();
	if(!birthRegExp.test(birth)) {
    	$('.span_birth_check').html("생년월일을 제대로 입력해주세요.");
        $('.span_birth_check').css("display","inline-block");
        $('.span_birth_check').css("color","#6A82FB");
		return false;
		
	} else {
    	$('.span_birth_check').css("display","none");
        return true;
    };
};

		/*[- end of function -]*/

		/*]]>*/
	</script>
</th:block>
</html>