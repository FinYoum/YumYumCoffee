<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yum.mapper.CartMapper">

	<sql id="cartColums">
		  user_num
		, product_num
		, branch_num
		, shot_custom
		, qty
		, total_price
		
	</sql>

	<!-- 카트 추가 -->
	<insert id ="insertCart" parameterType="com.yum.domain.CartDTO">
		INSERT into Cart (
		<!-- 	<include refid="cartColums"></include> -->
			user_num, product_num, branch_num, shot_custom, qty, total_price
		)VALUES(
				  #{userNum}
				, #{productNum}
				, #{branchNum}
				, #{shotCustom}
				, #{qty} 
				, #{totalPrice}
				)
	</insert>
	
	<!-- 카트 수량 수정 -->
	<update id="updateCartQty" parameterType="com.yum.domain.CartDTO">
		UPDATE CART
		SET QTY = #{qty}
		WHERE 
			USER_NUM = #{userNum} 
		AND 
			PRODUCT_NUM = #{productNum}
		AND 
			BRANCH_NUM = #{branchNum}
		AND 
			SHOT_CUSTOM = #{shotCustom}
	</update>
			
	<!-- 카트 수량 확인 -->
	<select id="countCartQty" parameterType="com.yum.domain.CartDTO" resultType="com.yum.domain.CartDTO">
		SELECT
			QTY
		FROM
			CART
		WHERE 
			USER_NUM = #{userNum} 
		AND 
			PRODUCT_NUM = #{productNum}
		AND 
			BRANCH_NUM = #{branchNum}
		AND 
			SHOT_CUSTOM = #{shotCustom}
	</select>
	
	<!-- 카트 삭제 -->
	<delete id="deleteCart" parameterType="com.yum.domain.CartDTO">
		DELETE FROM CART
		WHERE 
			USER_NUM = #{userNum} 
		AND 
			PRODUCT_NUM = #{productNum}
		AND 
			BRANCH_NUM = #{branchNum}
		AND 
			SHOT_CUSTOM = #{shotCustom}
	</delete>
	
	<!-- 카트 목록 -->
	<select id="selectCartList" parameterType="map" resultType="com.yum.domain.CartDTO">
		SELECT 
	 		c.USER_NUM 
	 		, c.PRODUCT_NUM 
	 		, c.BRANCH_NUM 
	 		, c.SHOT_CUSTOM 
	 		, c.QTY 
	 		, c.TOTAL_PRICE 
	 		, p.NAME 
	 	FROM 
	 		CART c 
	 		, PRODUCT p 
	 	WHERE 
	 		c.USER_NUM = #{userNum}
	 	AND 
	 		c.BRANCH_NUM = #{branchNum}
	 	AND 
	 		c.PRODUCT_NUM = p.PRODUCT_NUM 
	 	ORDER BY 
	 		c.INSERT_TIME DESC
	</select>
	
	<!-- 카트 갯수 확인 -->
	<select id="countTotalCart" parameterType="map" resultType="Long">
		SELECT 
			COUNT(*)
		FROM 
			CART
		WHERE 
			USER_NUM = #{userNum} 
	  	AND 
	  		BRANCH_NUM = #{branchNum}
  	  	ORDER BY 
  	  		INSERT_TIME DESC
	</select>
	
	<!-- 카트 확인 -->
 	<select id="checkCart" parameterType="com.yum.domain.CartDTO" resultType="com.yum.domain.CartDTO">
		SELECT * 
		FROM cart 
		WHERE user_num = #{userNum} 
		  AND product_num = #{productNum}
		  AND branch_num = #{branchNum}
	  	  AND shot_custom = #{shotCustom}
	</select> 
	
	
	
	<!-- 카트 추가 -->
	<insert id ="addCart" parameterType="com.yum.domain.CartDTO">
		
		INSERT into Cart2 (
			"CART_NUM"
			,USER_NUM
			,BRANCH_NUM
			,PRODUCT_NUM
			,"OPTION1"
			,"OPTION2"
			,"OPTION3"
			,"OPTION4"
			,QTY
			,PRICE			
			,TOTAL_PRICE
		)VALUES(
			cart2_seq.nextval ,
			#{userNum}, 
			#{branchNum}, 
			#{productNum},
			#{option1},
			#{option2},
			#{option3},
			#{option4},
			#{qty},
			#{price}, 			 
			#{totalPrice}
		)
	</insert>


	<select id="confirmCart" resultType="com.yum.domain.CartDTO">
		SELECT * FROM CART2
		WHERE   	
				USER_NUM =#{userNum} 
		AND 	product_num=#{productNum} 
		AND		OPTION1=#{option1}
		AND		OPTION2=#{option2}
		AND		OPTION3=#{option3}
		AND		OPTION4=#{option4}
	</select>


	<update id="updateCart2">
	UPDATE CART2
		SET qty = #{qty},
		total_price =#{totalPrice}
	WHERE   	
				USER_NUM =#{userNum} 
		AND 	product_num=#{productNum} 
		AND		option1=#{option1}
		AND		option2=#{option2}
		AND		option3=#{option3}
		AND		option4=#{option4}
	</update>
	

	<select id="getCartList" resultType="com.yum.domain.CartDTO">
        SELECT C.* , P.NAME
		
		,( select BRANCH_NAME FROM BRANCH WHERE BRANCH_NUM=C.BRANCH_NUM) as BRANCH_NAME
		
		FROM CART2 C
		
		INNER JOIN PRODUCT P		
		
		ON C.PRODUCT_NUM =P.PRODUCT_NUM	
		
		WHERE C.USER_NUM = #{userNum}	
             
	</select>




	<delete id="deleteCart2">
		DELETE cart2 WHERE CART_NUM=#{cartNum}
	</delete>

	
	<update id="updatePriceCart2">
	 UPDATE CART2
		
		SET qty = #{qty},
		
		total_price =#{totalPrice}
	
	WHERE   	
	
		CART_NUM=#{cartNum}
			
	</update>
	
	
</mapper>